---
# - name: Install WP
#   hosts: web
#   become: true
#   vars_files: 
#   - /home/kas/Рабочий стол/Crieket_lesson/Project/all.yml
#   tasks:
  - name: Add group "wordpress"
    group: 
      name: "{{ system_group }}"
 
  - name: Create system user
    user:
      name: "{{ system_user }}"
      group: "{{ system_group }}"
      system: yes
      create_home: yes
      home: "{{ web_root }}"
      shell: /bin/bash
      
  - name: Download Wordpress
    get_url:
      url: "https://wordpress.org/wordpress-{{ wp_version }}.tar.gz"
      dest: /tmp/wordpress.tar.gz

  - name: Extract Wordpress
    unarchive:
      src: /tmp/wordpress.tar.gz
      dest: /tmp/
      remote_src: no
      creates: /tmp/wordpress

  - name: Copy WordPress to web root
    copy:
      src: /tmp/wordpress/
      dest: "{{ web_root }}"
      remote_src: yes
      owner: "{{ system_user }}"
      group: "{{ system_group }}"
      mode: '0664'

  - name:  copy wordpress wp-config.php
    template:
      src: /home/kas/Рабочий стол/Crieket_lesson/Project/roles/wordpress/templates/wp-config.php.j2
      dest: "{{ web_root }}/wp-config.php"
      owner: "{{ system_user }}"
      group: "{{ system_group }}"
      mode: '0664'

  - name: Set proper permissions
    file:
      path: "{{ web_root }}"
      owner: "{{ system_user }}"
      group: "{{ system_group }}"
      recurse: yes
