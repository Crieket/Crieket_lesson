---
# - name: instal nginx
#   hosts: backend
#   become: yes
#   vars_files:
#    - /home/kas/Рабочий стол/Crieket_lesson/Project/all.yml
  
#   tasks:
  - name: update cache
    apt:
      update_cache: yes

  - name: Install nginx
    apt: 
      name: nginx 
      state: latest 
    
  - name: Add group "wordpress"
    group: 
      name: "{{ system_group }}"

  - name: Create a new user
    user:
      name: "{{ system_user }}"
      state: present
      createhome: no
      shell: /bin/bash
      group: "{{ system_group }}" 
      
  - name: Disable default site
    file: 
      path: /etc/nginx/sites-enabled/default
      state: absent

  - name: Create web root dir
    file: 
      path: "{{ wp_dir }}"
      state: directory 
      owner: wordpress 
      group: wordpress
      mode: '0755'

  - name: Create nginx config file from template
    template:
      src: /home/kas/Рабочий стол/Crieket_lesson/Project/roles/nginx/templates/wordpress.conf.j2
      dest: /etc/nginx/sites-available/{{ domain_name }}
    notify: restart nginx
            
  - name: Copy ssl
    copy:
      src: "{{ cert }}"
      dest: /etc/nginx
      owner: "{{system_user}}"
      group: "{{system_group}}"
      mode: 0664
    
  - name: Enable wp
    file:
      src: /etc/nginx/sites-available/{{ domain_name }}
      dest: /etc/nginx/sites-enabled/{{ domain_name }}
      state: link
  - name: start 
    service: 
    name: nginx
    state: started 
    enabled: yes
 
