Домашнее задание Резервное копирование
Цель домашнего задания
Научиться настраивать резервное копирование с помощью утилиты Borg
Описание домашнего задания
Настроить стенд Vagrant с двумя виртуальными машинами: backup_server и client. (Студент самостоятельно настраивает Vagrant)
Настроить удаленный бэкап каталога /etc c сервера client при помощи borgbackup. Резервные копии должны соответствовать следующим критериям:
директория для резервных копий /var/backup. Это должна быть отдельная точка монтирования. В данном случае для демонстрации размер не принципиален, достаточно будет и 2GB; (Студент самостоятельно настраивает)
репозиторий для резервных копий должен быть зашифрован ключом или паролем - на усмотрение студента;
имя бэкапа должно содержать информацию о времени снятия бекапа;
глубина бекапа должна быть год, хранить можно по последней копии на конец месяца, кроме последних трех. Последние три месяца должны содержать копии на каждый день. Т.е. должна быть правильно настроена политика удаления старых бэкапов;
резервная копия снимается каждые 5 минут. Такой частый запуск в целях демонстрации;
написан скрипт для снятия резервных копий. Скрипт запускается из соответствующей Cron джобы, либо systemd timer-а - на усмотрение студента;
настроено логирование процесса бекапа. Для упрощения можно весь вывод перенаправлять в logger с соответствующим тегом. Если настроите не в syslog, то обязательна ротация логов.






root@client:~# borg create --stats --list borg@192.168.1.10:/var/backup/repo::"etc-{now:%Y-%m-%d_%H:%M:%S}" /etc
Enter passphrase for key ssh://borg@192.168.1.10/var/backup/repo: 

~
~
~

Repository: ssh://borg@192.168.1.10/var/backup/repo
Archive name: etc-2026-01-18_14:05:37
Archive fingerprint: 6517b4eba5728eb0d426a78be3636d697e44e9985ed0ec4009018df6558eb371
Time (start): Sun, 2026-01-18 14:05:56
Time (end):   Sun, 2026-01-18 14:05:56
Duration: 0.20 seconds
Number of files: 689
Utilization of max. archive size: 0%
------------------------------------------------------------------------------
                       Original size      Compressed size    Deduplicated size
This archive:                2.09 MB            920.27 kB                656 B
All archives:                6.26 MB              2.76 MB            965.09 kB

                       Unique chunks         Total chunks
Chunk index:                     663                 2049
-------------------------------------------------------------------

root@client:~# borg list borg@192.168.1.10:/var/backup/repo
Enter passphrase for key ssh://borg@192.168.1.10/var/backup/repo: 
etc-2026-01-18_14-02                 Sun, 2026-01-18 14:02:21 [a977048260ca8eac1f1f79fdea104a32564171fcf238b4df85ef2e965cc0e59a]
etc-2026-01-18_14-05                 Sun, 2026-01-18 14:05:02 [f14b12d15c34ecce4884f635f6e7776f9d50a4375254fbc24f93f4331f118a12]
etc-2026-01-18_14:05:37              Sun, 2026-01-18 14:05:56 [6517b4eba5728eb0d426a78be3636d697e44e9985ed0ec4009018df6558eb371]

borg list borg@192.168.11.160:/var/backup/::etc

root@client:~# borg extract borg@192.168.1.10:/var/backup/repo::etc-2026-01-18_14:05:37 etc/
Enter passphrase for key ssh://borg@192.168.1.10/var/backup/repo: 
root@client:~# 



root@backup:~# borg list /var/backup/repo/
Enter passphrase for key /var/backup/repo: 
etc-2026-01-18_14-02                 Sun, 2026-01-18 14:02:21 [a977048260ca8eac1f1f79fdea104a32564171fcf238b4df85ef2e965cc0e59a]
etc-2026-01-18_14-05                 Sun, 2026-01-18 14:05:02 [f14b12d15c34ecce4884f635f6e7776f9d50a4375254fbc24f93f4331f118a12]
etc-2026-01-18_14:05:37              Sun, 2026-01-18 14:05:56 [6517b4eba5728eb0d426a78be3636d697e44e9985ed0ec4009018df6558eb371]
etc-2026-01-18_14:14:37              Sun, 2026-01-18 14:14:40 [3cf440c588ee6fe482e6304652a79df3ab9016bbd31d185386ed60f2dacf627b]
root@backup:~# 